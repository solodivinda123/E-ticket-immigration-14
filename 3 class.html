<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-TICKET - Étape 3: Information de Douane</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // Ensure QRCode library is loaded
        window.addEventListener('load', function() {
            if (typeof QRCode === 'undefined') {
                console.warn('QRCode library failed to load, will use fallback');
                // Load alternative QR library
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js';
                script.onload = function() {
                    console.log('QRCode library loaded successfully');
                };
                script.onerror = function() {
                    console.warn('Alternative QRCode library also failed to load');
                };
                document.head.appendChild(script);
            } else {
                console.log('QRCode library loaded successfully');
            }
        });
    </script>
</head>
<body>
    <div style="font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; padding: 20px;">
        <div style="max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden;">
            
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; position: relative;">
                <!-- Language Switcher -->
                <div style="position: absolute; top: 15px; right: 20px;">
                    <button onclick="toggleLanguage()" style="
                        background: rgba(255, 255, 255, 0.2);
                        border: 1px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 20px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 500;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        backdrop-filter: blur(10px);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        <i class="fas fa-globe"></i>
                        <span id="currentLanguage">FR</span>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                    </button>
                </div>
                
                <h2 style="font-size: 1.8rem; font-weight: 600; margin-bottom: 10px;">
                    <i class="fas fa-shield-alt"></i> <span data-lang="fr">INFORMATION DE DOUANNE</span><span data-lang="en" style="display: none;">CUSTOMS INFORMATION</span><span data-lang="es" style="display: none;">INFORMACIÓN DE ADUANAS</span>
                </h2>
                <p><span data-lang="fr">Étape 3: Déclaration en douane</span><span data-lang="en" style="display: none;">Step 3: Customs declaration</span><span data-lang="es" style="display: none;">Paso 3: Declaración de aduanas</span></p>
            </div>

            <!-- Progress Bar -->
            <div style="display: flex; align-items: center; justify-content: center; margin: 30px; gap: 10px;">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: #28a745; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">1</div>
                                         <div style="font-size: 0.8rem; font-weight: 600; text-align: center; color: #28a745; max-width: 120px;">
                         <span data-lang="fr">INFORMATION GENERALE</span>
                         <span data-lang="en" style="display: none;">GENERAL INFORMATION</span>
                         <span data-lang="es" style="display: none;">INFORMACIÓN GENERAL</span>
                     </div>
                 </div>
                 <div style="width: 60px; height: 2px; background: #28a745;"></div>
                 <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                     <div style="width: 40px; height: 40px; border-radius: 50%; background: #28a745; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">2</div>
                     <div style="font-size: 0.8rem; font-weight: 600; text-align: center; color: #28a745; max-width: 120px;">
                         <span data-lang="fr">DONNEES MIGRATOIRES</span>
                         <span data-lang="en" style="display: none;">MIGRATION DATA</span>
                         <span data-lang="es" style="display: none;">DATOS MIGRATORIOS</span>
                     </div>
                 </div>
                 <div style="width: 60px; height: 2px; background: #28a745;"></div>
                 <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                     <div style="width: 40px; height: 40px; border-radius: 50%; background: #007bff; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; animation: pulse 2s infinite;">3</div>
                     <div style="font-size: 0.8rem; font-weight: 700; text-align: center; color: #007bff; max-width: 120px;">
                         <span data-lang="fr">INFORMATION DE DOUANNE</span>
                         <span data-lang="en" style="display: none;">CUSTOMS INFORMATION</span>
                         <span data-lang="es" style="display: none;">INFORMACIÓN DE ADUANAS</span>
                     </div>
                </div>
            </div>

            <!-- Form Body -->
            <div style="padding: 40px;">
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span data-lang="fr">Les champs marqués d'un astérisque rouge (*) sont obligatoires</span>
                    <span data-lang="en" style="display: none;">Fields marked with a red asterisk (*) are mandatory</span>
                    <span data-lang="es" style="display: none;">Los campos marcados con un asterisco rojo (*) son obligatorios</span>
                </div>

                <form id="customsForm" onsubmit="handleFormSubmit(event)">
                    <!-- Customs Declaration Section -->
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-clipboard-list" style="color: #007bff;"></i> 
                            <span data-lang="fr">DÉCLARATION EN DOUANE</span>
                            <span data-lang="en" style="display: none;">CUSTOMS DECLARATION</span>
                            <span data-lang="es" style="display: none;">DECLARACIÓN DE ADUANAS</span>
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                <span data-lang="fr">Transportez-vous des marchandises ou objets soumis à déclaration ? *</span>
                                <span data-lang="en" style="display: none;">Do you carry goods or objects subject to declaration? *</span>
                                <span data-lang="es" style="display: none;">¿Transporta mercancías u objetos sujetos a declaración? *</span>
                            </label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="declaredGoods" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">
                                        <span data-lang="fr">Oui</span>
                                        <span data-lang="en" style="display: none;">Yes</span>
                                        <span data-lang="es" style="display: none;">Sí</span>
                                    </span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="declaredGoods" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">
                                        <span data-lang="fr">Non</span>
                                        <span data-lang="en" style="display: none;">No</span>
                                        <span data-lang="es" style="display: none;">No</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                <span data-lang="fr">Transportez-vous des devises ou instruments de paiement dépassant 10 000 USD ? *</span>
                                <span data-lang="en" style="display: none;">Do you carry currency or payment instruments exceeding 10,000 USD? *</span>
                                <span data-lang="es" style="display: none;">¿Transporta divisas o instrumentos de pago que excedan 10,000 USD? *</span>
                            </label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="currency" value="yes" required style="margin: 0;" onchange="toggleCurrencyAmount()">
                                    <span style="font-weight: 500; color: #333;">
                                        <span data-lang="fr">Oui</span>
                                        <span data-lang="en" style="display: none;">Yes</span>
                                        <span data-lang="es" style="display: none;">Sí</span>
                                    </span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="currency" value="no" required style="margin: 0;" onchange="toggleCurrencyAmount()">
                                    <span style="font-weight: 500; color: #333;">
                                        <span data-lang="fr">Non</span>
                                        <span data-lang="en" style="display: none;">No</span>
                                        <span data-lang="es" style="display: none;">No</span>
                                    </span>
                                </label>
                            </div>
                            <div id="currencyAmountBox" style="margin-top: 15px; padding: 15px; background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 6px; display: none;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                    <i class="fas fa-dollar-sign" style="color: #007bff; margin-right: 5px;"></i>
                                    <span data-lang="fr">Montant total des devises transportées (USD) *</span>
                                    <span data-lang="en" style="display: none;">Total amount of currency transported (USD) *</span>
                                    <span data-lang="es" style="display: none;">Monto total de divisas transportadas (USD) *</span>
                                </label>
                                <input type="number" name="currencyAmount" placeholder="Entrez le montant en USD" min="10000" step="0.01" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <small style="color: #6c757d; font-size: 0.875rem; margin-top: 5px; display: block;">
                                    <i class="fas fa-info-circle"></i> 
                                    <span data-lang="fr">Veuillez déclarer le montant total de toutes les devises et instruments de paiement</span>
                                    <span data-lang="en" style="display: none;">Please declare the total amount of all currency and payment instruments</span>
                                    <span data-lang="es" style="display: none;">Por favor declare el monto total de todas las divisas e instrumentos de pago</span>
                                </small>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des animaux vivants, plantes ou produits alimentaires ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="animals" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="animals" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des biens soumis à la taxe ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="taxGoods" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="taxGoods" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Prohibited Items Section -->
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-ban" style="color: #007bff;"></i> ARTICLES INTERDITS
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des armes, munitions ou explosifs ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="weapons" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="weapons" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des drogues, substances psychotropes ou médicaments sans ordonnance ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="drugs" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="drugs" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des objets de contrefaçon ou des produits illégaux ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="counterfeit" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="counterfeit" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Commercial Goods Section -->
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-shopping-cart" style="color: #007bff;"></i> MARCHANDISES COMMERCIALES
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Transportez-vous des marchandises à des fins commerciales ? *</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="commercialGoods" value="yes" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="commercialGoods" value="no" required style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Valeur totale estimée des marchandises transportées (USD)</label>
                            <input type="number" name="goodsValue" placeholder="0.00" min="0" step="0.01" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Description des marchandises principales</label>
                            <textarea name="goodsDescription" placeholder="Décrivez brièvement les marchandises transportées..." rows="3" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; font-family: inherit;"></textarea>
                        </div>
                    </div>

                    <!-- Personal Effects Section -->
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-suitcase" style="color: #007bff;"></i> EFFETS PERSONNELS
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Valeur totale de vos effets personnels (USD)</label>
                            <input type="number" name="personalEffectsValue" placeholder="0.00" min="0" step="0.01" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Nombre de bagages transportés</label>
                            <select name="luggageCount" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <option value="">Sélectionnez</option>
                                <option value="1">1 bagage</option>
                                <option value="2">2 bagages</option>
                                <option value="3">3 bagages</option>
                                <option value="4">4 bagages</option>
                                <option value="5+">5+ bagages</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle" style="color: #007bff;"></i> INFORMATIONS COMPLÉMENTAIRES
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Informations supplémentaires à déclarer</label>
                            <textarea name="additionalInfo" placeholder="Précisez toute information supplémentaire concernant vos biens..." rows="3" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; font-family: inherit;"></textarea>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Voyagez-vous avec des mineurs non accompagnés ?</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="unaccompaniedMinors" value="yes" style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Oui</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; border-radius: 6px;">
                                    <input type="radio" name="unaccompaniedMinors" value="no" style="margin: 0;">
                                    <span style="font-weight: 500; color: #333;">Non</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Terms and Conditions Section -->
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #856404; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-contract" style="color: #f39c12;"></i> CONDITIONS ET DÉCLARATIONS
                        </h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; padding: 12px; border-radius: 6px; background: #f8f9fa; border: 1px solid #e9ecef;">
                                <input type="checkbox" name="customsTerms" required style="margin: 0;">
                                <span style="font-weight: 500; color: #333; line-height: 1.4;">J'ai lu et j'accepte les conditions de déclaration en douane. *</span>
                            </label>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; padding: 12px; border-radius: 6px; background: #f8f9fa; border: 1px solid #e9ecef;">
                                <input type="checkbox" name="truthDeclaration" required style="margin: 0;">
                                <span style="font-weight: 500; color: #333; line-height: 1.4;">Je déclare que toutes les informations fournies sont exactes et complètes. *</span>
                            </label>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; padding: 12px; border-radius: 6px; background: #f8f9fa; border: 1px solid #e9ecef;">
                                <input type="checkbox" name="complianceDeclaration" required style="margin: 0;">
                                <span style="font-weight: 500; color: #333; line-height: 1.4;">Je m'engage à respecter toutes les réglementations douanières de la RDC. *</span>
                            </label>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                        <button type="button" onclick="goBack()" style="padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background: #6c757d; color: white; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-arrow-left"></i> RETOUR
                        </button>
                        <button type="submit" style="padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-arrow-right"></i> SUIVANT
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>

    <script>
        // Language configuration
        const languages = {
            fr: {
                code: 'FR',
                name: 'Français'
            },
            en: {
                code: 'EN', 
                name: 'English'
            },
            es: {
                code: 'ES',
                name: 'Español'
            }
        };
        
        let currentLanguage = 'fr';

        // Function to change language
        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // Update language button
            document.getElementById('currentLanguage').textContent = languages[lang].code;
            
            // Hide all language spans
            const allLangSpans = document.querySelectorAll('[data-lang]');
            allLangSpans.forEach(span => {
                span.style.display = 'none';
            });
            
            // Show only the current language spans
            const currentLangSpans = document.querySelectorAll(`[data-lang="${lang}"]`);
            currentLangSpans.forEach(span => {
                span.style.display = 'inline';
            });
            
            // Update placeholders
            updatePlaceholders(lang);
            
            // Update button texts
            updateButtonTexts(lang);
        }

        // Function to update placeholders
        function updatePlaceholders(lang) {
            const placeholders = {
                fr: {
                    currencyAmount: 'Entrez le montant en USD',
                    goodsValue: '0.00',
                    goodsDescription: 'Décrivez brièvement les marchandises transportées...',
                    personalEffectsValue: '0.00',
                    additionalInfo: 'Précisez toute information supplémentaire concernant vos biens...'
                },
                en: {
                    currencyAmount: 'Enter amount in USD',
                    goodsValue: '0.00',
                    goodsDescription: 'Briefly describe the goods being transported...',
                    personalEffectsValue: '0.00',
                    additionalInfo: 'Specify any additional information about your belongings...'
                },
                es: {
                    currencyAmount: 'Ingrese el monto en USD',
                    goodsValue: '0.00',
                    goodsDescription: 'Describa brevemente las mercancías transportadas...',
                    personalEffectsValue: '0.00',
                    additionalInfo: 'Especifique cualquier información adicional sobre sus pertenencias...'
                }
            };
            
            const inputs = {
                'input[name="currencyAmount"]': placeholders[lang].currencyAmount,
                'input[name="goodsValue"]': placeholders[lang].goodsValue,
                'textarea[name="goodsDescription"]': placeholders[lang].goodsDescription,
                'input[name="personalEffectsValue"]': placeholders[lang].personalEffectsValue,
                'textarea[name="additionalInfo"]': placeholders[lang].additionalInfo
            };
            
            Object.keys(inputs).forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    element.placeholder = inputs[selector];
                }
            });
        }

        // Function to update button texts
        function updateButtonTexts(lang) {
            const buttonTexts = {
                fr: {
                    back: 'RETOUR',
                    next: 'SUIVANT',
                    copy: 'Copier le Code',
                    download: 'Télécharger PDF',
                    close: 'Fermer'
                },
                en: {
                    back: 'BACK',
                    next: 'NEXT',
                    copy: 'Copy Code',
                    download: 'Download PDF',
                    close: 'Close'
                },
                es: {
                    back: 'VOLVER',
                    next: 'SIGUIENTE',
                    copy: 'Copiar Código',
                    download: 'Descargar PDF',
                    close: 'Cerrar'
                }
            };
            
            // Update form buttons
            const backBtn = document.querySelector('button[onclick="goBack()"]');
            const nextBtn = document.querySelector('button[type="submit"]');
            
            if (backBtn) {
                backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${buttonTexts[lang].back}`;
            }
            if (nextBtn) {
                nextBtn.innerHTML = `<i class="fas fa-arrow-right"></i> ${buttonTexts[lang].next}`;
            }
        }

        // Function to toggle language (cycle through languages)
        function toggleLanguage() {
            const languageOrder = ['fr', 'en', 'es'];
            const currentIndex = languageOrder.indexOf(currentLanguage);
            const nextIndex = (currentIndex + 1) % languageOrder.length;
            const nextLanguage = languageOrder[nextIndex];
            
            changeLanguage(nextLanguage);
        }

        // Function to toggle currency amount input box
        function toggleCurrencyAmount() {
            const currencyYes = document.querySelector('input[name="currency"][value="yes"]');
            const currencyAmountBox = document.getElementById('currencyAmountBox');
            const currencyAmountInput = document.querySelector('input[name="currencyAmount"]');
            
            if (currencyYes.checked) {
                currencyAmountBox.style.display = 'block';
                currencyAmountInput.required = true;
            } else {
                currencyAmountBox.style.display = 'none';
                currencyAmountInput.required = false;
                currencyAmountInput.value = '';
            }
        }

        // Function to generate unique application code
        function generateApplicationCode() {
            const timestamp = Date.now().toString(36);
            const randomStr = Math.random().toString(36).substring(2, 8).toUpperCase();
            const year = new Date().getFullYear().toString().substring(2);
            return `ET-${year}-${randomStr}-${timestamp}`;
        }

        // Function to generate QR code SVG using QRCode library
        function generateQRCodeSVG(text) {
            return new Promise((resolve, reject) => {
                // Check if QRCode library is available
                if (typeof QRCode === 'undefined') {
                    console.warn('QRCode library not loaded, using fallback');
                    resolve(generateSimpleQRPattern(text));
                    return;
                }

                try {
                    QRCode.toDataURL(text, {
                        width: 200,
                        height: 200,
                        color: {
                            dark: '#000000',
                            light: '#FFFFFF'
                        },
                        errorCorrectionLevel: 'M'
                    }, function (err, url) {
                        if (err) {
                            console.error('QR Code generation error:', err);
                            // Fallback to simple pattern if QR library fails
                            resolve(generateSimpleQRPattern(text));
                        } else {
                            resolve(`<img src="${url}" alt="QR Code" style="width: 200px; height: 200px; border: 1px solid #ddd; border-radius: 4px;">`);
                        }
                    });
                } catch (error) {
                    console.error('QR Code generation caught error:', error);
                    resolve(generateSimpleQRPattern(text));
                }
            });
        }

        // Fallback function for simple QR pattern
        function generateSimpleQRPattern(text) {
            const size = 200;
            const cellSize = 8;
            const cells = size / cellSize;
            
            let svg = `<svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">`;
            svg += `<rect width="${size}" height="${size}" fill="white"/>`;
            
            // Generate a simple pattern based on text hash
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                hash = ((hash << 5) - hash + text.charCodeAt(i)) & 0xffffffff;
            }
            
            // Create QR-like pattern
            for (let y = 0; y < cells; y++) {
                for (let x = 0; x < cells; x++) {
                    const index = (y * cells + x) % 32;
                    const bit = (hash >> index) & 1;
                    
                    if (bit) {
                        svg += `<rect x="${x * cellSize}" y="${y * cellSize}" width="${cellSize}" height="${cellSize}" fill="black"/>`;
                    }
                }
            }
            
            svg += '</svg>';
            return `<div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-family: monospace; font-size: 12px; color: #666; margin-bottom: 10px;">
                            QR Code Pattern (Fallback)
                        </div>
                        ${svg}
                        <div style="font-size: 10px; color: #999; margin-top: 10px;">
                            Code: ${text}
                        </div>
                    </div>`;
        }

        // Function to generate PDF content
        async function generatePDFContent(applicationCode) {
            try {
                const formData = new FormData(document.getElementById('customsForm'));
                const currentDate = new Date().toLocaleDateString('fr-FR');
                
                // Try to generate QR code, with fallback
                let qrCodeSVG;
                try {
                    qrCodeSVG = await generateQRCodeSVG(applicationCode);
                } catch (error) {
                    console.error('QR Code generation failed:', error);
                    qrCodeSVG = generateSimpleQRPattern(applicationCode);
                }
                
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>E-Ticket - ${applicationCode}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 40px; }
                            .header { text-align: center; border-bottom: 3px solid #007bff; padding-bottom: 20px; margin-bottom: 30px; }
                            .logo { font-size: 24px; font-weight: bold; color: #007bff; }
                            .code { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; font-family: monospace; font-size: 18px; }
                            .qr-section { text-align: center; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
                            .qr-code { display: inline-block; margin: 10px; }
                            .section { margin: 25px 0; }
                            .section h3 { color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                            .field { margin: 10px 0; }
                            .label { font-weight: bold; color: #333; }
                            .value { color: #666; }
                            .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }
                            table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background: #f8f9fa; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <div class="logo">🏛️ RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</div>
                            <h1>E-TICKET IMMIGRATION</h1>
                            <p>Formulaire de déclaration en douane</p>
                        </div>

                        <div class="code">
                            <strong>CODE D'APPLICATION:</strong> ${applicationCode}
                        </div>

                        <div class="qr-section">
                            <h3>📱 QR Code pour Code d'Application</h3>
                            <div class="qr-code">
                                ${qrCodeSVG}
                            </div>
                            <p style="margin-top: 10px; font-size: 12px; color: #666;">
                                Scannez ce QR code pour accéder rapidement à votre code d'application
                            </p>
                        </div>

                        <div class="section">
                            <h3>📋 DÉCLARATION EN DOUANE</h3>
                            <div class="field">
                                <span class="label">Marchandises soumises à déclaration:</span>
                                <span class="value">${formData.get('declaredGoods') || 'Non renseigné'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Devises > 10 000 USD:</span>
                                <span class="value">${formData.get('currency') || 'Non renseigné'}</span>
                            </div>
                            ${formData.get('currency') === 'yes' ? `
                            <div class="field">
                                <span class="label">Montant déclaré:</span>
                                <span class="value">${formData.get('currencyAmount') || 'Non renseigné'} USD</span>
                            </div>
                            ` : ''}
                            <div class="field">
                                <span class="label">Animaux vivants/plantes:</span>
                                <span class="value">${formData.get('animals') || 'Non renseigné'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Biens soumis à taxe:</span>
                                <span class="value">${formData.get('taxGoods') || 'Non renseigné'}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>🚫 ARTICLES INTERDITS</h3>
                            <div class="field">
                                <span class="label">Armes/munitions/explosifs:</span>
                                <span class="value">${formData.get('weapons') || 'Non renseigné'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Drogues/médicaments sans ordonnance:</span>
                                <span class="value">${formData.get('drugs') || 'Non renseigné'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Objets de contrefaçon:</span>
                                <span class="value">${formData.get('counterfeit') || 'Non renseigné'}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>🛒 MARCHANDISES COMMERCIALES</h3>
                            <div class="field">
                                <span class="label">Marchandises à fins commerciales:</span>
                                <span class="value">${formData.get('commercialGoods') || 'Non renseigné'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Valeur estimée:</span>
                                <span class="value">${formData.get('goodsValue') || '0.00'} USD</span>
                            </div>
                            <div class="field">
                                <span class="label">Description:</span>
                                <span class="value">${formData.get('goodsDescription') || 'Non renseigné'}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>💼 EFFETS PERSONNELS</h3>
                            <div class="field">
                                <span class="label">Valeur totale:</span>
                                <span class="value">${formData.get('personalEffectsValue') || '0.00'} USD</span>
                            </div>
                            <div class="field">
                                <span class="label">Nombre de bagages:</span>
                                <span class="value">${formData.get('luggageCount') || 'Non renseigné'}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>ℹ️ INFORMATIONS COMPLÉMENTAIRES</h3>
                            <div class="field">
                                <span class="label">Informations supplémentaires:</span>
                                <span class="value">${formData.get('additionalInfo') || 'Aucune'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Mineurs non accompagnés:</span>
                                <span class="value">${formData.get('unaccompaniedMinors') || 'Non renseigné'}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>✅ DÉCLARATIONS</h3>
                            <div class="field">
                                <span class="label">Conditions de douane acceptées:</span>
                                <span class="value">${formData.get('customsTerms') ? 'Oui' : 'Non'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Déclaration d'exactitude:</span>
                                <span class="value">${formData.get('truthDeclaration') ? 'Oui' : 'Non'}</span>
                            </div>
                            <div class="field">
                                <span class="label">Engagement de conformité:</span>
                                <span class="value">${formData.get('complianceDeclaration') ? 'Oui' : 'Non'}</span>
                            </div>
                        </div>

                        <div class="footer">
                            <p><strong>Date de création:</strong> ${currentDate}</p>
                            <p>Ce document est généré automatiquement par le système E-Ticket RDC</p>
                            <p>Conservez ce document pour vos références futures</p>
                        </div>
                    </body>
                    </html>
                `;
            } catch (error) {
                console.error('Error generating PDF content:', error);
                throw new Error('Erreur lors de la génération du contenu PDF');
            }
        }

        // Function to download PDF
        async function downloadPDF(applicationCode) {
            try {
                console.log('Starting PDF download for code:', applicationCode);
                
                // Show loading message
                const downloadBtn = event.target;
                const originalText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Génération...';
                downloadBtn.disabled = true;
                
                // Generate PDF content
                const pdfContent = await generatePDFContent(applicationCode);
                console.log('PDF content generated successfully');
                
                // Create a blob with the HTML content
                const blob = new Blob([pdfContent], { type: 'text/html;charset=utf-8' });
                console.log('Blob created:', blob.size, 'bytes');
                
                // Check if blob was created successfully
                if (!blob || blob.size === 0) {
                    throw new Error('Le blob PDF est vide');
                }
                
                // Create download link
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `E-Ticket-${applicationCode}.html`;
                
                // Add link to DOM temporarily
                document.body.appendChild(link);
                
                // Trigger download
                link.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                }, 100);
                
                console.log('PDF download initiated successfully');
                
                // Show success message
                setTimeout(() => {
                    downloadBtn.innerHTML = '<i class="fas fa-check"></i> Téléchargé!';
                    downloadBtn.style.background = '#20c997';
                    
                    setTimeout(() => {
                        downloadBtn.innerHTML = originalText;
                        downloadBtn.style.background = '#dc3545';
                        downloadBtn.disabled = false;
                    }, 2000);
                }, 500);
                
            } catch (error) {
                console.error('Error in downloadPDF:', error);
                
                // Reset button
                const downloadBtn = event.target;
                downloadBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Télécharger PDF';
                downloadBtn.disabled = false;
                
                // Show error message
                alert(`Erreur lors de la génération du PDF: ${error.message}\n\nVeuillez réessayer ou contacter le support technique.`);
            }
        }

        // Function to show success modal with application code
        function showSuccessModal(applicationCode) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: 'Inter', sans-serif;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 40px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    position: relative;
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #28a745, #20c997);
                        border-radius: 50%;
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 2rem;
                    ">
                        <i class="fas fa-check"></i>
                    </div>
                    
                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.5rem;">
                        <i class="fas fa-ticket-alt" style="color: #007bff; margin-right: 8px;"></i>
                        E-Ticket Créé avec Succès!
                    </h2>
                    
                    <p style="color: #6c757d; margin-bottom: 25px; line-height: 1.6;">
                        Votre demande d'e-Ticket a été enregistrée avec succès. 
                        Conservez précieusement votre code d'application pour toute référence future.
                    </p>
                    
                    <div style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 20px;
                        border-radius: 10px;
                        margin: 20px 0;
                        border: 2px dashed #fff;
                    ">
                        <div style="font-size: 0.9rem; margin-bottom: 8px; opacity: 0.9;">
                            <i class="fas fa-key"></i> CODE D'APPLICATION
                        </div>
                        <div style="
                            font-size: 1.8rem;
                            font-weight: 700;
                            letter-spacing: 2px;
                            font-family: 'Courier New', monospace;
                            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        ">
                            ${applicationCode}
                        </div>
                    </div>
                    
                    <div style="
                        background: #e8f4fd;
                        border: 1px solid #bee5eb;
                        border-radius: 8px;
                        padding: 15px;
                        margin: 20px 0;
                        text-align: left;
                    ">
                        <h4 style="color: #0c5460; margin-bottom: 10px; font-size: 1rem;">
                            <i class="fas fa-info-circle"></i> Informations importantes:
                        </h4>
                        <ul style="color: #0c5460; margin: 0; padding-left: 20px; font-size: 0.9rem;">
                            <li>Ce code vous permet de créer un nouveau eTicket à partir de ce précédent</li>
                            <li>Conservez ce code en lieu sûr pour toute modification future</li>
                            <li>Vous recevrez également un email de confirmation</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap;">
                        <button onclick="copyApplicationCode('${applicationCode}')" style="
                            padding: 12px 16px;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            background: #28a745;
                            color: white;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            flex: 1;
                            min-width: 140px;
                        ">
                            <i class="fas fa-copy"></i> Copier le Code
                        </button>
                        <button onclick="downloadPDF('${applicationCode}')" style="
                            padding: 12px 16px;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            background: #dc3545;
                            color: white;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            flex: 1;
                            min-width: 140px;
                        ">
                            <i class="fas fa-file-pdf"></i> Télécharger PDF
                        </button>
                        <button onclick="closeSuccessModal()" style="
                            padding: 12px 16px;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            background: #6c757d;
                            color: white;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            flex: 1;
                            min-width: 140px;
                        ">
                            <i class="fas fa-times"></i> Fermer
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Function to copy application code to clipboard
        function copyApplicationCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                // Show temporary success message
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copié!';
                button.style.background = '#20c997';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#28a745';
                }, 2000);
            }).catch(err => {
                console.error('Erreur lors de la copie:', err);
                alert('Erreur lors de la copie du code. Veuillez le noter manuellement.');
            });
        }

        // Function to close success modal
        function closeSuccessModal() {
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                modal.remove();
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const requiredFields = document.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = field.closest('div').parentElement;
                    const checkedRadio = radioGroup.querySelector('input[type="radio"]:checked');
                    if (!checkedRadio) {
                        isValid = false;
                    }
                } else if (!field.value) {
                    isValid = false;
                }
            });
            
            if (isValid) {
                // Save form data to localStorage
                saveCustomsData();
                
                // Redirect to confirmation page
                window.location.href = 'confirmation.html';
            } else {
                alert('Veuillez remplir tous les champs obligatoires.');
            }
        }

        function saveCustomsData() {
            const form = document.getElementById('customsForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Save to localStorage with the correct key for confirmation page
            localStorage.setItem('customsData', JSON.stringify(data));
        }

        function goBack() {
            if (confirm('Êtes-vous sûr de vouloir revenir en arrière ?')) {
                window.location.href = '2 clas.html';
            }
        }

        // Test function to debug PDF download
        function testPDFDownload() {
            console.log('Testing PDF download...');
            const testCode = 'ET-TEST-12345';
            downloadPDF(testCode);
        }

        // Add test button for debugging (remove in production)
        window.addEventListener('load', function() {
            const testBtn = document.createElement('button');
            testBtn.innerHTML = '🧪 Test PDF';
            testBtn.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                z-index: 1000;
                padding: 8px 12px;
                background: #ffc107;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            testBtn.onclick = testPDFDownload;
            document.body.appendChild(testBtn);
        });
    </script>
</body>
</html>
